<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" type="image/x-icon" href="Assets/logo.png">
<title>Register - ELYSIUM</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

<style>
:root {
    --pink: #f2a3c7;
    --text: #ffffff;
    --muted: #b5b5b5;
}

* { box-sizing: border-box; margin:0; padding:0; }

body {
    font-family: Inter, system-ui, sans-serif;
    background: radial-gradient(circle at top, #161216, #0b0b0c 65%);
    color: var(--text);
    min-height: 100vh;
    display: grid;
    place-items: center;
}

main {
    width: 100%;
    max-width: 380px;
    padding: 2.5rem;
    text-align: center;
}

h1 {
    font-size: 2.6rem;
    font-weight: 700;
    margin-bottom: 2rem;
    background: linear-gradient(180deg, #ffffff, #e8c4d6);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

form {
    display: flex;
    flex-direction: column;
    gap: 14px;
}

input {
    padding: 13px 16px;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.15);
    background: rgba(255,255,255,0.06);
    color: var(--text);
}

input:focus {
    outline: none;
    border-color: var(--pink);
    box-shadow: 0 0 10px rgba(242,163,199,0.4);
}

.cf-turnstile {
    display: flex;
    justify-content: center;
    margin-top: 4px;
}

button {
    padding: 13px;
    border-radius: 12px;
    font-weight: 600;
    border: none;
    cursor: pointer;
}

.primary {
    background: linear-gradient(180deg, #f2a3c7, #d98fb1);
    color: #0b0b0c;
    opacity: 0.5;
}

.primary:enabled {
    opacity: 1;
}

.discord {
    margin-top: 14px;
    background: #5865F2;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.or {
    margin: 12px 0;
    font-size: 0.8rem;
    color: var(--muted);
}

p {
    margin-top: 1.4rem;
    font-size: 0.85rem;
    color: var(--muted);
}

p a {
    color: var(--pink);
    text-decoration: none;
    font-weight: 600;
}
</style>

<script>
function captchaSolved() {
    document.getElementById("registerBtn").disabled = false;
}

function loginWithDiscord() {
    window.location.href = "/api/auth/discord";
}
</script>
</head>
<body>

<main>
    <h1>ELYSIUM</h1>

    <form id="registerForm" method="POST">
        <input type="email" name="email" placeholder="Email" required>
        <input type="password" name="password" placeholder="Password" required>

        <div class="cf-turnstile"
             data-sitekey="0x4AAAAAACZ5VmQVnV4BLXU1"
             data-theme="dark"
             data-callback="captchaSolved">
        </div>

        <button id="registerBtn" class="primary" type="submit">
            Register
        </button>
    </form>

    <div class="or">or</div>

    <button type="button" class="discord" style="width:100%" onclick="loginWithDiscord()">
        <i class="fa-brands fa-discord"></i> Continue with Discord
    </button>

    <p>Already have an account? <a href="/static/login.html">Login</a></p>
</main>

</body>
</html>

<script>
document.getElementById('registerForm').addEventListener('submit', async function(e){
    e.preventDefault();
    const btn = document.getElementById('registerBtn');
    btn.disabled = true;
    const form = new FormData(e.target);

    try {
        const res = await fetch('/api/register', {
            method: 'POST',
            body: form,
            credentials: 'include'
        });
        if (!res.ok) {
            const err = await res.json().catch(()=>({detail:'Register failed'}));
            alert(err.detail || 'Register failed');
            btn.disabled = false;
            return;
        }
        const data = await res.json();
        if (data.redirect) window.location.href = data.redirect;
    } catch (err) {
        alert('Network error');
        btn.disabled = false;
    }
});
</script>
